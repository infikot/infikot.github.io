<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>infikot's Lab</title>
    <link rel="icon" href="https://github.githubassets.com/favicons/favicon-dark.svg" type="image/svg+xml">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root {
            --bg-color: #121212;
            --primary-text-color: #e0e0e0;
            --secondary-text-color: #b0b0b0;
            --card-bg: #1e1e1e;
            --card-border: #333;
            --card-hover-border: #007bff;
            --button-bg: #2a2a2a;
            --button-hover-bg: #3a3a3a;
            --button-active-bg: #007bff;
            --button-active-color: #fff;
            --highlight-glow: 0 0 15px rgba(0, 123, 255, 0.6);
            --font-family: 'Inter', sans-serif;
        }
        html { scroll-behavior: smooth; }
        body { background-color: var(--bg-color); color: var(--primary-text-color); font-family: var(--font-family); margin: 0; padding: 40px 20px 80px 20px; box-sizing: border-box; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; text-align: center; }
        header h1 { font-size: 3rem; font-weight: 900; }
        header p { font-size: 1.2rem; color: var(--secondary-text-color); margin-top: -1rem; }
        
        .view-switcher { display: flex; justify-content: center; gap: 10px; margin: 30px 0; }
        .view-btn { background-color: var(--button-bg); color: var(--primary-text-color); border: 1px solid var(--card-border); padding: 10px 20px; font-size: 1rem; font-weight: 700; border-radius: 8px; cursor: pointer; transition: background-color 0.2s, color 0.2s; }
        .view-btn:hover { background-color: var(--button-hover-bg); }
        .view-btn.active { background-color: var(--button-active-bg); color: var(--button-active-color); border-color: var(--button-active-bg); }

        #projects-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; text-align: left; }
        
        /* --- 1. СТИЛИ ДЛЯ ЗАГРУЗЧИКА --- */
        #loader { border: 4px solid #f3f3f330; border-top: 4px solid var(--card-hover-border); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 50px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none; }
        /* ---------------------------------- */

        .project-card, .app-card { background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: 8px; padding: 25px; text-decoration: none; color: inherit; display: flex; flex-direction: column; transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.3s ease; }
        .project-card:hover, .app-card:hover { transform: translateY(-5px); border-color: var(--card-hover-border); }
        
        /* --- 2. СТИЛИ ДЛЯ ПОДСВЕТКИ --- */
        .project-card.highlighted, .app-card.highlighted { border-color: var(--card-hover-border); box-shadow: var(--highlight-glow); transform: translateY(-5px) scale(1.02); }
        /* ---------------------------------- */

        .app-card { position: relative; }
        .app-card-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .app-card-icon { width: 48px; height: 48px; border-radius: 8px; object-fit: cover; flex-shrink: 0; }
        .app-card-title-wrapper { flex-grow: 1; position: relative; }
        h2 { margin: 0 0 10px 0; font-size: 1.5rem; font-weight: 700; color: var(--primary-text-color); }
        .app-card h2 { padding-right: 55px; }
        .app-version { position: absolute; top: 0; right: 0; font-size: 0.8rem; font-weight: 700; color: var(--secondary-text-color); background-color: rgba(255, 255, 255, 0.05); padding: 3px 8px; border-radius: 12px; border: 1px solid var(--card-border); }
        p { font-size: 1rem; color: var(--secondary-text-color); line-height: 1.5; flex-grow: 1; margin-bottom: 20px; }
        .app-card .download-btn { display: inline-block; background-color: var(--button-active-bg); color: var(--button-active-color); padding: 12px 20px; border-radius: 6px; text-align: center; text-decoration: none; font-weight: 700; margin-top: auto; transition: background-color 0.2s; }
        .app-card .download-btn:hover { background-color: #0056b3; }

        .lang-switcher { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .lang-switcher a { color: var(--secondary-text-color); text-decoration: none; margin: 0 5px; font-weight: 700; padding: 5px; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .lang-switcher a.active { color: var(--primary-text-color); border-bottom-color: var(--card-hover-border); }
        
        .footer { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000;}
        #author-signature { color: var(--secondary-text-color); cursor: pointer; font-size: 0.9rem; padding: 5px 10px; transition: color 0.2s; }
        #author-signature:hover { color: var(--primary-text-color); }
        #links-popup { position: absolute; bottom: 120%; left: 50%; background-color: var(--card-bg); border: 1px solid var(--card-border); border-radius: 8px; padding: 10px; display: flex; flex-direction: column; gap: 10px; opacity: 0; visibility: hidden; transform: translate(-50%, 10px); transition: opacity 0.3s ease, transform 0.3s ease, visibility 0s 0.3s; z-index: 1001; }
        #links-popup.visible { opacity: 1; visibility: visible; transform: translate(-50%, 0); transition-delay: 0s; }
        #links-popup a { color: var(--primary-text-color); text-decoration: none; padding: 8px 15px; display: block; border-radius: 5px; transition: background-color 0.2s; white-space: nowrap; }
        #links-popup a:hover { background-color: rgba(255, 255, 255, 0.1); }
        
        /* --- 3. СТИЛИ ДЛЯ УВЕДОМЛЕНИЙ --- */
        #notification-area { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; display: flex; flex-direction: column; gap: 10px; align-items: center; }
        .notification { padding: 12px 20px; border-radius: 8px; color: var(--primary-text-color); font-weight: 700; animation: fadeInOut 5s forwards; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .notification.error { background-color: #d32f2f; }
        @keyframes fadeInOut { 0% { opacity: 0; transform: translateY(-20px); } 15% { opacity: 1; transform: translateY(0); } 85% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-20px); } }
        /* ---------------------------------- */
    </style>
</head>
<body>
    <!-- Область для уведомлений -->
    <div id="notification-area"></div>

    <div class="container">
        <header>
            <h1>infikot's Lab</h1>
            <p id="page-subtitle"></p>
        </header>

        <div class="view-switcher">
            <button class="view-btn" id="apps-btn" data-view="apps"></button>
            <button class="view-btn" id="projects-btn" data-view="projects"></button>
        </div>

        <main id="projects-grid">
            <!-- Здесь теперь спиннер, а не текст -->
            <div id="loader"></div>
            <p id="loading-message" class="hidden"></p>
        </main>
    </div>

    <div class="lang-switcher">
        <a href="#" class="lang-btn" data-lang="ru">RU</a>
        <a href="#" class="lang-btn" data-lang="en">EN</a>
    </div>

    <div class="footer">
        <span id="author-signature">by infikot</span>
        <div id="links-popup">
            <a href="https://github.com/infikot/" target="_blank">GitHub</a>
            <a href="https://t.me/infinite_edit" target="_blank">Telegram</a>
        </div>
    </div>

    <script>
        const USERNAME = 'infikot';
        // --- DOM Elements ---
        const subtitle = document.getElementById('page-subtitle');
        const grid = document.getElementById('projects-grid');
        const loader = document.getElementById('loader');
        const langButtons = document.querySelectorAll('.lang-btn');
        const viewButtons = document.querySelectorAll('.view-btn');
        const authorSignature = document.getElementById('author-signature');
        const linksPopup = document.getElementById('links-popup');

        // --- State ---
        let currentLang = localStorage.getItem('preferredLang') || 'ru';
        let currentView = localStorage.getItem('preferredView') || 'apps';
        let pageData = null;
        let appsData = null;

        // --- Helper Functions ---
        function getTranslation(obj, lang) {
            return obj?.[lang] || obj?.['en'] || '...';
        }
        
        function showNotification(message, type = 'error') {
            const notificationArea = document.getElementById('notification-area');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notificationArea.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 5000); // Уведомление исчезнет через 5 секунд
        }

        // --- Rendering Functions ---
        function renderProjectsGrid() {
            grid.innerHTML = '';
            if (!pageData?.projects || pageData.projects.length === 0) {
                grid.innerHTML = `<p>${getTranslation({ru: "Проекты не найдены.", en: "No projects found."}, currentLang)}</p>`;
                return;
            }
            pageData.projects.forEach(repo => {
                const card = document.createElement('a');
                card.className = 'project-card';
                // Добавляем ID для подсветки
                card.id = `card-${repo.name}`;
                card.href = `https://${USERNAME}.github.io/${repo.name}/`;
                card.target = '_self';
                card.innerHTML = `
                    <h2>${repo.name}</h2>
                    <p>${getTranslation(repo.description, currentLang)}</p>
                `;
                grid.appendChild(card);
            });
        }

        function renderAppsGrid() {
            grid.innerHTML = '';
            if (!appsData?.apps || appsData.apps.length === 0) {
                grid.innerHTML = `<p>${getTranslation({ru: "Приложения не найдены.", en: "No apps found."}, currentLang)}</p>`;
                return;
            }
            appsData.apps.forEach(app => {
                const card = document.createElement('div');
                card.className = 'app-card';
                // Добавляем ID для подсветки
                card.id = `card-${app.name}`;
                const versionTag = app.version ? `<span class="app-version">${app.version}</span>` : '';
                card.innerHTML = `
                    <div class="app-card-header">
                        <img src="${app.icon_url}" alt="${app.name} icon" class="app-card-icon" onerror="this.style.display='none'">
                        <div class="app-card-title-wrapper">
                            <h2>${app.name}</h2>
                            ${versionTag}
                        </div>
                    </div>
                    <p>${getTranslation(app.description, currentLang)}</p>
                    <a href="${app.exe_url}" class="download-btn" target="_blank" rel="noopener noreferrer">${getTranslation({ru: "Скачать", en: "Download"}, currentLang)}</a>
                `;
                grid.appendChild(card);
            });
        }
        
        // --- Main UI Update Function ---
        function updateUI() {
            if (!pageData) return;
            document.documentElement.lang = currentLang;
            langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === currentLang));
            subtitle.textContent = getTranslation(pageData.pageInfo.subtitle, currentLang);
            document.getElementById('apps-btn').textContent = getTranslation(pageData.ui.apps_tab, currentLang);
            document.getElementById('projects-btn').textContent = getTranslation(pageData.ui.projects_tab, currentLang);
            viewButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.view === currentView));

            if (currentView === 'apps') {
                renderAppsGrid();
            } else {
                renderProjectsGrid();
            }
            
            // После рендера пытаемся подсветить карточку
            handleHighlighting();
        }
        
        // --- Deep Linking & Highlighting Logic ---
        function handleHighlighting() {
            const hash = window.location.hash.substring(1);
            if (!hash) return;
            
            // Удаляем подсветку со старых элементов
            document.querySelectorAll('.highlighted').forEach(el => el.classList.remove('highlighted'));

            const targetCard = document.getElementById(`card-${hash}`);
            if (targetCard) {
                targetCard.classList.add('highlighted');
                // Прокручиваем к элементу, помещая его в центр экрана
                targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function handleInitialHash() {
            const hash = window.location.hash.substring(1);
            if (!hash) return;

            // Ищем в приложениях
            const foundInApps = appsData?.apps.find(app => app.name === hash);
            if (foundInApps) {
                currentView = 'apps';
                localStorage.setItem('preferredView', 'apps');
                return; // Нашли, выходим
            }
            // Ищем в проектах
            const foundInProjects = pageData?.projects.find(project => project.name === hash);
            if (foundInProjects) {
                currentView = 'projects';
                localStorage.setItem('preferredView', 'projects');
                return; // Нашли, выходим
            }
            
            // Если дошли сюда, значит ничего не нашли
            showNotification(getTranslation({ru: `Проект "${hash}" не найден`, en: `Project "${hash}" not found`}));
        }

        // --- Initialization ---
        async function initializeApp() {
            try {
                const [pageResponse, appsResponse] = await Promise.all([
                    fetch('./config.json'),
                    fetch('./apps/config.json')
                ]);
                if (!pageResponse.ok) throw new Error('Failed to load config.json');
                pageData = await pageResponse.json();
                if (appsResponse.ok) {
                    appsData = await appsResponse.json();
                } else {
                    console.warn('Could not load apps/config.json.');
                    appsData = { apps: [] };
                }
                
                // Сначала обрабатываем хеш, чтобы выбрать правильную вкладку
                handleInitialHash();
                
                loader.classList.add('hidden'); // Прячем спиннер
                updateUI();
            } catch (error) {
                console.error('Initialization error:', error);
                loader.classList.add('hidden'); // Прячем спиннер даже при ошибке
                const loadingMessage = document.getElementById('loading-message');
                loadingMessage.textContent = 'Ошибка загрузки конфигурационных файлов. Проверь консоль.';
                loadingMessage.classList.remove('hidden');
            }
        }

        // --- Event Listeners ---
        langButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                currentLang = e.target.dataset.lang;
                localStorage.setItem('preferredLang', currentLang);
                updateUI();
            });
        });

        viewButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                currentView = e.target.dataset.view;
                localStorage.setItem('preferredView', currentView);
                updateUI();
            });
        });

        authorSignature.addEventListener('click', (e) => {
            e.stopPropagation();
            linksPopup.classList.toggle('visible');
        });

        document.addEventListener('click', (e) => {
            if (!linksPopup.contains(e.target) && !authorSignature.contains(e.target)) {
                linksPopup.classList.remove('visible');
            }
        });

        // --- Start the App ---
        initializeApp();
    </script>
</body>
</html>
